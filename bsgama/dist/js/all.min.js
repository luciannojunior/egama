var cgama=angular.module("cgama",["ui.router","ngStorage","angular-jwt","ngLodash","ngDialog"]);cgama.config(["$stateProvider","$urlRouterProvider","$httpProvider",function(e,o,t){o.otherwise("/"),e.state("main",{url:"/",templateUrl:"view/main.html",controller:"MainController as mainCtrl"}).state("aluno",{url:"/aluno",templateUrl:"view/aluno.html"}).state("relatorios",{url:"/relatorios",templateUrl:"view/relatorios.html",controller:"RelatoriosController as reportCtrl"})}]),cgama.value("apiRoot","http://localhost:3000"),cgama.constant("ENDPOINTS",{LOGIN:"/access/login",STUDENT:"/students"}),cgama.constant("ERRORS",{LOGIN:"Erro ao logar",STUDENT:"/students"}),cgama.service("HttpService",["$http","$q","apiRoot","lodash","$localStorage",function(e,o,t,r,n){function i(){return n.token?n.token:""}var a=["post","get","put","patch","delete"];this.request=function(n){var l=o.defer();if(r.forEach(n,function(e,o){return r.isUndefined(e)||r.isEmpty(e)?(l.reject("Invalid configuration for HTTP Request"),l.promise):void 0}),!r.includes(a,r.toLower(n.method)))return l.reject("Invalid HTTP method"),l.promise;var s=i();return e({method:n.method,url:t+n.uri,data:n.body||{},headers:{Authorization:"JWT "+s}}).then(function(e){var o=e.data;403==e.status?($window.location.href="login.html",l.reject("Unauthorized")):r.isUndefined(o.err)?l.reject("Internal error 17"):o.err[0]?l.reject(o.err[1]):l.resolve(o.output)},function(e){l.reject(e)}),l.promise}}]),cgama.service("MainService",["HttpService","lodash","$q",function(e,o,t){var r=this;this.appInfo={},r.getInfo=function(){var o=t.defer();return e.request({method:"get",uri:"/api/info"}).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise}}]),cgama.service("Modal",["ngDialog",function(e){function o(o){return e.open({template:o,plain:!0,className:"ngdialog-theme-default"})}function t(o){return e.open({template:o,plain:!0,className:"ngdialog-theme-erro"})}return{sucesso:o,erro:t}}]),cgama.service("User",["HttpService","$localStorage","jwtHelper","ENDPOINTS","lodash","$q",function(e,o,t,r,n,i){function a(){return l.isLoggedIn()?JSON.parse(o.user):{}}var l=this;l.profile={},this.getName=function(){return l.isLoggedIn()?a().name:""},this.isLoggedIn=function(){return!n.isUndefined(o.user)},this.login=function(n,a){var l=i.defer();if(this.isLoggedIn())return l.reject("User is already logged in"),l.promise;var s={login:n,password:a};return e.request({method:"post",uri:r.LOGIN,body:s}).then(function(e){o.token=e;var r=JSON.stringify(t.decodeToken(e));o.user=r,l.resolve(JSON.parse(r))},function(e){l.reject(e)}),l.promise},this.logout=function(){o.$reset()}}]),cgama.controller("IndexController",["User","$window",function(e,o){!function(){e.isLoggedIn()||(o.location.href="login.html")}();var t={};t.nome=e.getName(),this.usuario=t,this.logout=function(){e.logout(),o.location.href="login.html"}}]),cgama.controller("LoginController",["User","$window","Modal","ERRORS",function(e,o,t,r){var n=this;!function(){e.isLoggedIn()&&(o.location.href="index.html")}(),n.loading=!1,n.login=function(i){i=i||{},n.loading=!0,e.login(i.login,i.password).then(function(e){n.loading=!1,t.sucesso("<h1>Sucesso ao logar</h1><p>Bem-vindo(a) <b>"+e.name+"</b>, você será redirecionado!</p>"),setTimeout(function(){o.location.href="index.html"},2e3)},function(e){n.loading=!1,t.erro("<h1>"+r.LOGIN+"</h1><p>"+e+"</p>")})}}]),cgama.controller("MainController",["$stateParams","User","MainService",function(e,o,t){function r(){var e=new Date,o=["janeiro","fevereiro","março","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"],t=["Segunda-Feira","Terça-feira","Quarta-feira","Quinta-feira","Sexta-Feira","Sábado","Domingo"],r="Hoje é "+t[e.getDay()-1]+", ";return r+=e.getDate().toString()+" de "+o[e.getMonth()]+" de "+e.getFullYear().toString()}var n=this;this.date=r(),this.info={},function(){t.getInfo().then(function(e){n.info=e},function(e){console.log(e)})}()}]),cgama.controller("RelatoriosController",["$stateParams","User",function(e,o){}]);